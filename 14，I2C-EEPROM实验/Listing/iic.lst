C51 COMPILER V9.01   IIC                                                                   09/30/2022 15:47:05 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE IIC
OBJECT MODULE PLACED IN ..\Obj\iic.obj
COMPILER INVOKED BY: D:\programming learning software\MCU\keilC51\C51\BIN\C51.EXE ..\App\bsp_iic\iic.c BROWSE INCDIR(..\
                    -App\bsp_24c02;..\Public;..\App\bsp_iic;..\App\bsp_key;..\App\bsp_smg) DEBUG OBJECTEXTEND PRINT(..\Listing\iic.lst) OBJEC
                    -T(..\Obj\iic.obj)

line level    source

   1          #include  "iic.h"
   2          
   3          /*
   4                  函数名： IIC_Start
   5                  功能：   产生IIC起始信号
   6          */
   7          void IIC_Start(void)
   8          {
   9   1              IIC_SCL = 1;
  10   1              IIC_SDA = 1;
  11   1              Delay_10us(1);
  12   1              IIC_SDA = 0;    //当SCL为高电平时，SDA由高变为低
  13   1              Delay_10us(1);
  14   1              IIC_SCL = 0;    //钳住I2C总线，准备发送或接收数据
  15   1      }
  16          
  17          
  18          /*
  19                  函数名： IIC_Stop
  20                  功能：   产生IIC停止信号        
  21          */
  22          void IIC_Stop(void)
  23          {
  24   1              IIC_SCL = 1;
  25   1              IIC_SDA = 0;
  26   1              Delay_10us(1);
  27   1              IIC_SDA = 1;    //当SCL为高电平时，SDA由低变为高
  28   1              Delay_10us(1);                  
  29   1      }
  30          
  31          /*
  32                  函数名： IIC_Ack
  33                  功能：   产生ACK应答信号
  34          */
  35          void IIC_Ack(void)
  36          {
  37   1              IIC_SCL = 0;
  38   1              IIC_SDA = 0;    //SDA为低电平
  39   1              Delay_10us(1);
  40   1              IIC_SCL = 1;
  41   1              Delay_10us(1);
  42   1              IIC_SCL = 0;
  43   1      }
  44          
  45          /*
  46                  函数名： IIC_Nack
  47                  功能：   产生NACK非应答信号
  48          */
  49          void IIC_Nack(void)
  50          {
  51   1              IIC_SCL = 0;
  52   1              IIC_SDA = 1;    //SDA为高电平
  53   1              Delay_10us(1);
C51 COMPILER V9.01   IIC                                                                   09/30/2022 15:47:05 PAGE 2   

  54   1              IIC_SCL = 1;
  55   1              Delay_10us(1);
  56   1              IIC_SCL = 0;    
  57   1      }
  58          
  59          /*
  60                  函数名： IIC_Wait_Ack
  61                  功能：   等待应答信号到来
  62                  注意：   返回1，则接收应答失败；返回0，则接收应答成功
  63          */
  64          uint_8 IIC_Wait_Ack(void)
  65          {
  66   1              uint_8 time_temp = 0;
  67   1              
  68   1              IIC_SCL = 1;
  69   1              Delay_10us(1);
  70   1              while(IIC_SDA)  //等待SDA为低电平
  71   1              {
  72   2                      time_temp++;
  73   2                      if(time_temp > 100)     
  74   2                      {       
  75   3                              IIC_Stop();             //超时则强制结束IIC通信
  76   3                              return 1;       
  77   3                      }                       
  78   2              }
  79   1              IIC_SCL = 0;
  80   1              return 0;       
  81   1      }
  82          
  83          /*
  84                  函数名： IIC_Nack
  85                  功能：   IIC发送一个字节
  86          */
  87          void IIC_Write_Byte(uint_8 dat)
  88          {                        
  89   1          uint_8 i = 0; 
  90   1                          
  91   1          IIC_SCL = 0;
  92   1          for(i=0;i<8;i++)    //循环8次将一个字节传出，先传高再传低位
  93   1          {              
  94   2              if( (dat&0x80) > 0) 
  95   2                              IIC_SDA = 1;
  96   2                      else
  97   2                              IIC_SDA = 0;
  98   2              dat <<= 1;        
  99   2                      Delay_10us(1);  
 100   2                      IIC_SCL = 1;
 101   2                      Delay_10us(1); 
 102   2                      IIC_SCL = 0;    
 103   2                      Delay_10us(1);
 104   2          }    
 105   1      }
 106          
 107          /*
 108                  函数名： IIC_Nack
 109                  功能：   IIC读一个字节
 110                  注意：   ack=1时，发送ACK，ack=0，发送nACK
 111          */
 112          uint_8 IIC_Read_Byte(uint_8 ack)
 113          {
 114   1              uint_8 i = 0,rec_dat = 0;
 115   1      
C51 COMPILER V9.01   IIC                                                                   09/30/2022 15:47:05 PAGE 3   

 116   1          for(i=0;i<8;i++)    //循环8次将一个字节读出，先读高再读低位
 117   1              {
 118   2              IIC_SCL = 0; 
 119   2              Delay_10us(1);
 120   2                      IIC_SCL = 1;
 121   2              rec_dat <<= 1;
 122   2              if(IIC_SDA)     
 123   2                              rec_dat++;   
 124   2                      Delay_10us(1); 
 125   2          }                                    
 126   1          if (!ack)
 127   1              IIC_Nack();
 128   1          else
 129   1              IIC_Ack();  
 130   1                        
 131   1          return rec_dat;
 132   1      }
 133          
 134          
 135          
 136          
 137          
 138          
 139          
 140          
 141          
 142          
 143          
 144          
 145          
 146          
 147          
 148          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    250    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
